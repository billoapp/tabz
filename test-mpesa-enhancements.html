<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Pesa Payment Enhancements Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>M-Pesa Payment Enhancements Test</h1>
    
    <div class="test-section">
        <h2>Task 4.1: Partial Payment Amount Validation</h2>
        <p>Test that payment amounts are validated correctly against outstanding balance.</p>
        
        <div>
            <label>Outstanding Balance: KSh <input type="number" id="balance" value="1000" /></label><br>
            <label>Payment Amount: KSh <input type="number" id="amount" value="500" /></label><br>
            <button onclick="testAmountValidation()">Test Amount Validation</button>
        </div>
        
        <div id="amount-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Task 4.2: Enhanced Phone Number Validation</h2>
        <p>Test that phone number validation supports multiple formats and provides real-time feedback.</p>
        
        <div>
            <label>Phone Number: <input type="tel" id="phone" placeholder="0712345678" /></label><br>
            <button onclick="testPhoneValidation()">Test Phone Validation</button>
        </div>
        
        <div id="phone-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Phone Number Formats</h2>
        <p>Click buttons to test different phone number formats:</p>
        
        <button onclick="testPhoneFormat('0712345678')">Test 0712345678</button>
        <button onclick="testPhoneFormat('254712345678')">Test 254712345678</button>
        <button onclick="testPhoneFormat('712345678')">Test 712345678</button>
        <button onclick="testPhoneFormat('0701234567')">Test 0701234567 (Invalid)</button>
        <button onclick="testPhoneFormat('invalid')">Test Invalid Format</button>
        
        <div id="format-results"></div>
    </div>

    <script>
        // Mock validation functions based on the implementation
        function validateAmount(amount, balance) {
            const numAmount = parseFloat(amount);
            const numBalance = parseFloat(balance);
            
            if (isNaN(numAmount) || numAmount <= 0) {
                return {
                    isValid: false,
                    error: 'Payment amount must be greater than zero'
                };
            }
            
            if (numAmount > numBalance) {
                return {
                    isValid: false,
                    error: `Payment amount cannot exceed KSh ${numBalance}`
                };
            }
            
            return {
                isValid: true,
                message: `Valid payment amount: KSh ${numAmount}`,
                remaining: numBalance - numAmount
            };
        }
        
        function validatePhoneNumber(phone) {
            // Simplified validation based on the implementation
            const sanitized = phone.replace(/\D/g, '');
            
            if (!sanitized) {
                return {
                    isValid: false,
                    error: 'Phone number is required',
                    suggestions: ['Enter your M-PESA phone number (e.g., 0712345678)']
                };
            }
            
            // Check different formats
            if (sanitized.startsWith('254') && sanitized.length === 12) {
                const localNumber = '0' + sanitized.substring(3);
                return validateLocalFormat(localNumber);
            } else if (sanitized.startsWith('0') && sanitized.length === 10) {
                return validateLocalFormat(sanitized);
            } else if (sanitized.length === 9 && sanitized.startsWith('7')) {
                return validateLocalFormat('0' + sanitized);
            } else {
                return {
                    isValid: false,
                    error: 'Invalid phone number format',
                    suggestions: [
                        'Use format: 0712345678 (10 digits starting with 0)',
                        'Or: 254712345678 (international format)',
                        'Or: 712345678 (9 digits without prefix)'
                    ]
                };
            }
        }
        
        function validateLocalFormat(phone) {
            if (phone.length !== 10 || !phone.startsWith('0')) {
                return {
                    isValid: false,
                    error: 'Phone number must be exactly 10 digits starting with 0'
                };
            }
            
            const prefix = phone.substring(1, 3);
            const validPrefixes = ['70', '71', '72', '73', '74', '75', '76', '77', '78', '79'];
            
            if (!validPrefixes.includes(prefix)) {
                return {
                    isValid: false,
                    error: `Invalid network prefix: ${prefix}`,
                    suggestions: ['Kenyan mobile numbers should start with 070X, 071X, 072X, etc.']
                };
            }
            
            return {
                isValid: true,
                formatted: phone.replace(/(\d{4})(\d{3})(\d{3})/, '$1 $2 $3'),
                international: '254' + phone.substring(1)
            };
        }
        
        function testAmountValidation() {
            const balance = document.getElementById('balance').value;
            const amount = document.getElementById('amount').value;
            const result = validateAmount(amount, balance);
            
            const resultsDiv = document.getElementById('amount-results');
            let html = '';
            
            if (result.isValid) {
                html += `<div class="test-result pass">✓ ${result.message}</div>`;
                if (result.remaining > 0) {
                    html += `<div class="test-result info">Remaining balance: KSh ${result.remaining}</div>`;
                }
            } else {
                html += `<div class="test-result fail">✗ ${result.error}</div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function testPhoneValidation() {
            const phone = document.getElementById('phone').value;
            const result = validatePhoneNumber(phone);
            
            const resultsDiv = document.getElementById('phone-results');
            let html = '';
            
            if (result.isValid) {
                html += `<div class="test-result pass">✓ Valid phone number</div>`;
                html += `<div class="test-result info">Formatted: ${result.formatted}</div>`;
                html += `<div class="test-result info">International: ${result.international}</div>`;
            } else {
                html += `<div class="test-result fail">✗ ${result.error}</div>`;
                if (result.suggestions) {
                    html += '<div class="test-result info">Suggestions:<ul>';
                    result.suggestions.forEach(suggestion => {
                        html += `<li>${suggestion}</li>`;
                    });
                    html += '</ul></div>';
                }
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function testPhoneFormat(phone) {
            const result = validatePhoneNumber(phone);
            
            const resultsDiv = document.getElementById('format-results');
            let html = resultsDiv.innerHTML;
            
            html += `<div class="test-result ${result.isValid ? 'pass' : 'fail'}">`;
            html += `<strong>${phone}:</strong> ${result.isValid ? '✓ Valid' : '✗ ' + result.error}`;
            if (result.formatted) {
                html += ` (${result.formatted})`;
            }
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }
        
        // Auto-test on page load
        window.onload = function() {
            testAmountValidation();
            document.getElementById('phone').value = '0712345678';
            testPhoneValidation();
        };
    </script>
</body>
</html>